[gd_scene load_steps=16 format=2]

[ext_resource path="res://adventure/pics/flippeny.png" type="Texture" id=1]
[ext_resource path="res://battle/sounds/sproingoCentipede.wav" type="Sample" id=2]
[ext_resource path="res://battle/sounds/sproingoIntro.wav" type="Sample" id=3]

[sub_resource type="GDScript" id=1]

script/source = "extends \"../scripts/actor.gd\"

onready var head = preload(\"res://battle/objects/snakeHead.tscn\")
onready var body = preload(\"res://battle/objects/snakeBody.tscn\")
onready var player = get_node(\"../player\")

func _ready():
	addRoutine(\"flirt1\")
	addRoutine(\"worm\")


func flirt1():
	yield(createSoundWaiter(sound).r(\"intro\"),S)
	health = 70
	var angle = 0
	var tick = createTimer(0.22)
	var tick2 = createTimer(0.2)
	var length = 10
	var num = 8
	while (true):
		for i in range(num):
			shoot(head,PI * 2 / num * i + angle)
		yield(tick.r(),T)
		
		for l in range(length):
			for i in range(num):
				angle += 0.01
				shoot(body,PI * 2 / num * i + angle)
			yield(tick.r(),T)
		angle -= 0.5
		yield(tick2.r(),T)
		if (isDone()): return

func worm():
	yield(createSoundWaiter(sound).r(\"centipede\"),S)
	health = 70
	var pos = get_pos()
	var otherPos = pos
	otherPos.y = 600
	var snakes = [[pos,pos,pos,pos,pos,pos,pos],[otherPos,otherPos,otherPos]]
	var bullets = []
	var tick = createTimer(0.3)
	var jump = 50
	var turn = 0

	while (true):
		turn += 0.1
		for snake in snakes:
			var front = snake.front()
			var angle = front.angle_to_point(player.get_pos()) + sin(turn + snake.size())
			front.x -= sin(angle) * jump
			front.y -= cos(angle) * jump
			snake.push_front(front)
			snake.pop_back()
		
		for ref in bullets:
			var bullet = ref.get_ref()
			if (bullet): bullet.queue_free()
		bullets.clear()
		
		
		for snake in snakes:
			var h = true
			for pose in snake:
				pose.x += (randf() - 0.5) * 7
				pose.y += (randf() - 0.5) * 7
				bullets.append(weakref(shootFrom(head if h else body,0,pose,0)))
				h = false
		
		
		yield(tick.r(),T)
		if (isDone()): return
	"

[sub_resource type="ConvexPolygonShape2D" id=2]

custom_solver_bias = 0.0
points = PoolVector2Array( 80.3064, -16.2551, 81.277, 76.9229, 47.6295, 23.2162, 48.2765, -1.37247 )

[sub_resource type="ConvexPolygonShape2D" id=3]

custom_solver_bias = 0.0
points = PoolVector2Array( 24.335, -60.2557, 66.718, -75.4619, 48.2765, -1.37247 )

[sub_resource type="ConvexPolygonShape2D" id=4]

custom_solver_bias = 0.0
points = PoolVector2Array( -29.3718, -105.227, -28.0776, -108.786, 22.3938, -126.257, 86.1301, -105.227, 77.0711, -89.0503, 11.7171, -76.4325, -12.8715, -86.7856 )

[sub_resource type="ConvexPolygonShape2D" id=5]

custom_solver_bias = 0.0
points = PoolVector2Array( -12.8715, -86.7856, -33.2542, -90.3445, -29.3718, -105.227 )

[sub_resource type="ConvexPolygonShape2D" id=6]

custom_solver_bias = 0.0
points = PoolVector2Array( -44.9014, -63.4911, 47.6295, 23.2162, 63.1591, 110.247, -41.6661, 128.365, -83.0785, 115.1, -83.0785, -52.4909 )

[sub_resource type="ConvexPolygonShape2D" id=7]

custom_solver_bias = 0.0
points = PoolVector2Array( -44.9014, -63.4911, -42.3131, -80.3149, -17.401, -79.3443, 11.7171, -76.4325, 24.335, -60.2557, 48.2765, -1.37247, 47.6295, 23.2162 )

[sub_resource type="ConvexPolygonShape2D" id=8]

custom_solver_bias = 0.0
points = PoolVector2Array( -17.401, -79.3443, -12.8715, -86.7856, 11.7171, -76.4325 )

[sub_resource type="Resource" id=9]

samples/centipede = {
"db": 2.0,
"pitch": 1.0,
"priority": 0,
"sample": ExtResource( 2 )
}
samples/intro = {
"db": 2.0,
"pitch": 1.0,
"priority": 0,
"sample": ExtResource( 3 )
}

[sub_resource type="Animation" id=10]

length = 0.4
loop = true
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": PoolRealArray( 0, 0.1, 0.2, 0.3 ),
"transitions": PoolRealArray( 1, 1, 1, 1 ),
"update": 1,
"values": [ 2, 3, 4, 3 ]
}

[sub_resource type="Animation" id=11]

length = 0.2
loop = true
step = 0.1
tracks/0/type = "value"
tracks/0/path = NodePath(".:frame")
tracks/0/interp = 1
tracks/0/imported = false
tracks/0/keys = {
"times": PoolRealArray( 0, 0.1 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 1,
"values": [ 0, 1 ]
}

[node name="sproing" type="Sprite" groups=[
"target",
]]

texture = ExtResource( 1 )
script = SubResource( 1 )
flippy = false
walky = false
target = true
speed = 100

[node name="hitbox" type="Area2D" parent="."]

use_parent_material = true
input_pickable = true
shapes/0/shape = SubResource( 2 )
shapes/0/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/0/trigger = false
shapes/1/shape = SubResource( 3 )
shapes/1/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/1/trigger = false
shapes/2/shape = SubResource( 4 )
shapes/2/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/2/trigger = false
shapes/3/shape = SubResource( 5 )
shapes/3/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/3/trigger = false
shapes/4/shape = SubResource( 6 )
shapes/4/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/4/trigger = false
shapes/5/shape = SubResource( 7 )
shapes/5/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/5/trigger = false
shapes/6/shape = SubResource( 8 )
shapes/6/transform = Transform2D( 1, 0, 0, 1, 0, 0 )
shapes/6/trigger = false
gravity_vec = Vector2( 0, 1 )
gravity = 98.0
linear_damp = 0.1
angular_damp = 1.0

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="hitbox"]

show_behind_parent = true
build_mode = 0
polygon = PoolVector2Array( -28.0776, -108.786, 22.3938, -126.257, 86.1301, -105.227, 77.0711, -89.0503, 11.7171, -76.4325, 24.335, -60.2557, 66.718, -75.4619, 48.2765, -1.37247, 80.3064, -16.2551, 81.277, 76.9229, 47.6295, 23.2162, 63.1591, 110.247, -41.6661, 128.365, -83.0785, 115.1, -83.0785, -52.4909, -44.9014, -63.4911, -42.3131, -80.3149, -17.401, -79.3443, -12.8715, -86.7856, -33.2542, -90.3445, -29.3718, -105.227 )
shape_range = Vector2( 0, 6 )
trigger = false

[node name="sound" type="Node" parent="."]

polyphony = 1
samples = SubResource( 9 )
default/volume_db = 0.0
default/pitch_scale = 1.0
default/pan = 0.0
default/depth = 0.0
default/height = 0.0
default/filter/type = 0
default/filter/cutoff = 5000.0
default/filter/resonance = 1.0
default/filter/gain = 1.0
default/reverb_room = 2
default/reverb_send = 0.0
default/chorus_send = 0.0

[node name="animation" type="AnimationPlayer" parent="."]

playback_process_mode = 1
playback_default_blend_time = 0.0
root_node = NodePath("..")
anims/press = SubResource( 10 )
anims/still = SubResource( 11 )
playback/active = true
playback/speed = 1.0
blend_times = [  ]
autoplay = "still"
